<!DOCTYPE html>
<html>
    <head>
        <title>PhillyVoteCheck</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
        <!-- Latest compiled and minified JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href='//fonts.googleapis.com/css?family=Abel|Open+Sans:400,600' rel='stylesheet'>
        <link href='//fonts.googleapis.com/css?family=Alegreya+Sans+SC' rel='stylesheet' type='text/css'>
        <link href="css/mycustom.css" rel="stylesheet" type='text/css'> 
        <script>
            var endpointURL = "http://pavoter.banderkat.com/pavoter";
            var ward;
            var division;
            var street;
            var city;
            var state;
            var accessible;
            var mapURL = "https://www.google.com/maps/embed/v1/place?key=AIzaSyA1cj60UVxHhj2ZawATBb014EFHYtXudtQ&q=";
            $(document).ready(function () {
                $('#verify_button').click(function (e) {
                    e.preventDefault();
                    if ($("#error_msg_panel").is(':visible')){
                        $("#error_msg_panel").hide();  
                    }
                    var fName = $('#firstName').val();
                    var lName = $('#lastName').val();
                    var dateOfBirth = $('#dob').val();
                    var county = $('#county').val();
                    var params = {firstName: fName, lastName: lName, dob: dateOfBirth};
                    if (county) {
                        params.county = county;
                    }
                    $('#request_panel').addClass('hidden');
                    $('#registrationSpinner').removeClass('hidden');
                    $.ajax({
                        method: 'POST',
                        url: 'http://pavoter.banderkat.com/pavoter',
                        data: JSON.stringify(params),
                        dataType: 'json',
                        contentType: ' application/json; charset=utf-8',
                    }).done(function (data) {
                        console.log(data);
                        var jsonObj = $.parseJSON(JSON.stringify(data));
                        if (jsonObj.registration.hasOwnProperty('notFound')) {
                            $('#registrationSpinner').addClass('hidden');
                            $('#request_panel').removeClass('hidden');
                            $("#error_msg_panel").append(jsonObj.registration.notFound);
                            $("#error_msg_panel").show();
                            return;
                        }
                        accessible = jsonObj.registration.polling_place.accessibility;
                        ward = jsonObj.registration.ward;
                        division = jsonObj.registration.division;
                        placename = jsonObj.registration.polling_place.name;
                        street =jsonObj.registration.polling_place.address.street;
                        city =jsonObj.registration.polling_place.address.city;
                        state = jsonObj.registration.polling_place.address.state;
                        $('#polling_place_result').text(placename);
                        $("#street").append("Street: " + street);
                        $("#my_street").attr("value", street);
                        $("#city").append("City " + city);
                        $("#my_city").attr("value", city);
                        $("#state").append("State: " + state);
                        $("#my_state").attr("value", state);
                        $("#division").append("Division: " + division);
                        $("#my_division").attr("value", division);
                        $('#registrationSpinner').addClass('hidden');
                        $("#results_panel").show();
                    }).fail(function (error) {
                        console.log(error.status + ': ' + error.statusText);
                        $('#registrationSpinner').addClass('hidden');
                        $('#request_panel').removeClass('hidden');
                    });
                });
                $('#find_polling_button').click(function (e) {
                    e.preventDefault();
                    var myWard = $('#my_ward').val();
                    var myDivision = $('#my_division').val();
                    var address = $('#my_street').val() + " " + $('#my_city').val() + " " + $('#my_state').val();
                    var encodedAddress = encodeURIComponent(address);
                    $('#request_panel').hide();
                    $('#results_panel').hide();
                    $('#map_iframe').attr('src', mapURL + encodedAddress)
                    $('#polling_place_map').show();
                    if (accessible == "Handicap not accessible"){
                        $('#accessible_places_btn_div').show();
                        $('#not_accessible_msg').append(accessible)
                        $('#not_accessible_msg').show();
                    }
                });
                $('find_accessible_places_button').click(function(e){
                    
                });
            });
            function processResult(data) {
                alert("data: " + data);
            }

        </script>
    </head>
    <body>
        <div class="header-img">
            <img class="right logo" src="img/phillyvotes.png" />
        </div>
        <div class="container-fluid" style="width:100%">

            <div class="well well-lg center registered_box" id="request_panel">
                <div>Am I registered?</div>
                <div class="input-group">
                    <form>
                        <div>
                            <input type="text" class="form-control" placeholder="First Name" id="firstName">
                            <input type="text" class="form-control" placeholder="Last Name" id="lastName">
                            <input type="text" class="form-control" placeholder="Date of Birth(mm/dd/yyyy)" id="dob">
                            <input type="text" class="form-control" placeholder="County" id="county">
                        </div>
                        <div class="right">
                            <button type="submit" class="btn btn-default submit_button" id="verify_button">Verify</button>
                        </div>
                    </form>
                </div>
                <div id="error_msg_panel" class="error_msg" style="display:none;"></div>
            </div>
            <div id="registrationSpinner" class="well well-lg center hidden">
                <div class="spinner">
                    <div class="spinner-container container1">
                        <div class="circle1"></div>
                        <div class="circle2"></div>
                        <div class="circle3"></div>
                        <div class="circle4"></div>
                    </div>
                    <div class="spinner-container container2">
                        <div class="circle1"></div>
                        <div class="circle2"></div>
                        <div class="circle3"></div>
                        <div class="circle4"></div>
                    </div>
                    <div class="spinner-container container3">
                        <div class="circle1"></div>
                        <div class="circle2"></div>
                        <div class="circle3"></div>
                        <div class="circle4"></div>
                    </div>
                </div>
            </div>
            <div class="well well-lg center registered_box" id="results_panel" style="display: none;">
                <div class="input-group" >
                    <form>
                        <div>
                        <div id="county_result"></div> 
                        <div id="polling_place_result">Polling Place</div> 
                        <div id="street"></div>
                        <input type="hidden" name="my_street" id="my_street" />
                        <div id="city"></div>
                        <input type="hidden" name="my_city" id="my_city" />
                        <div id="state"></div>
                        <input type="hidden" name="my_state" id="my_state" />
                        <div id="ward"></div>
                        <input type="hidden" name="my_ward" id="my_ward" />
                        <div id="division"></div>
                        <input type="hidden" name="my_division" id="my_division" />
                        <div id="accessibility_result"></div>
                        </div>
                        <div class="right">
                            <button type="submit" class="btn btn-default submit_button" id="find_polling_button">Find my polling place</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="panel panel-success center map_panel" id="polling_place_map" style="display: none;">
            <div class="panel-heading">
                <h3 class="panel-title">My Polling Place</h3>
            </div>
            <div class="panel-body">              
                    <iframe
                        id="map_iframe"
                        width="600"
                        height="450"
                        frameborder="0" style="border:0"
                        src="https://www.google.com/maps/embed/v1/place?key=AIzaSyA1cj60UVxHhj2ZawATBb014EFHYtXudtQ
                        &q=330+Race+St,Philadelphia+PA">
                    </iframe>
                <div id="not_accessible_msg" class="error_msg" style="display:none;"></div>
                <div class="right" style="display: none;" id="accessible_places_btn_div">
                    <form action="accessible_places.html">
                    <button type="submit" class="btn btn-default submit_button" id="find_accessible_places_button">Find accessible places</button>
                    </form>
                </div>
            </div>
        </div>
    </body>
</html>
